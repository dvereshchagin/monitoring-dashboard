replicaCount: 2

ha:
  enabled: true

# Redis Cache for Performance
redis:
  enabled: true
  maxMemory: "1gb"
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"

# Database Migrations
migrations:
  enabled: true
  version: "003"

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 8
  targetCPUUtilizationPercentage: 65
  targetMemoryUtilizationPercentage: 75

releaseAnalyzer:
  enabled: true
  interval: 20s

gateway:
  enabled: true
  replicaCount: 2
  ha:
    enabled: true
  podDisruptionBudget:
    enabled: true
    minAvailable: 1
  auth:
    enabled: false

podDisruptionBudget:
  enabled: true
  minAvailable: 1

config:
  AUTH_ENABLED: "false"
  SCREENSHOT_AUTH_ENABLED: "false"
  DB_SSL_MODE: "require"
  ALLOWED_ORIGINS: "*"
  S3_ENABLED: "true"
  S3_BUCKET: "monitoring-dashboard-staging-screenshots-729665432048"
  S3_REGION: "eu-north-1"
  S3_ENDPOINT: "https://s3.eu-north-1.amazonaws.com"
  S3_USE_PATH_STYLE: "true"

  # Performance Optimizations - 100+ RPS support
  DB_MAX_OPEN_CONNS: "100"
  DB_MAX_IDLE_CONNS: "50"

  # Redis Cache
  REDIS_ENABLED: "true"
  REDIS_HOST: "redis-cache"
  REDIS_PORT: "6379"
  REDIS_DB: "0"
  REDIS_CACHE_TTL: "60s"
  REDIS_POOL_SIZE: "100"
  REDIS_MIN_IDLE_CONNS: "20"
  REDIS_DIAL_TIMEOUT: "5s"
  REDIS_READ_TIMEOUT: "3s"
  REDIS_WRITE_TIMEOUT: "3s"

  # CloudWatch Integration (disabled until credentials configured)
  CLOUDWATCH_METRICS_ENABLED: "false"
  CLOUDWATCH_LOGS_ENABLED: "false"
  CLOUDWATCH_REGION: "us-east-1"
  CLOUDWATCH_METRICS_NAMESPACE: "MonitoringDashboard/Staging"
  CLOUDWATCH_METRICS_BUFFER_SIZE: "100"
  CLOUDWATCH_METRICS_FLUSH_INTERVAL: "10s"
  CLOUDWATCH_METRICS_STORAGE_RESOLUTION: "60"
  CLOUDWATCH_METRICS_DIMENSIONS: "Environment=staging,Cluster=eu-north-1"
  CLOUDWATCH_LOG_GROUP: "/aws/monitoring-dashboard/staging"
  CLOUDWATCH_LOG_STREAM: "application"
  CLOUDWATCH_LOGS_BUFFER_SIZE: "50"
  CLOUDWATCH_LOGS_FLUSH_INTERVAL: "5s"

externalSecrets:
  data:
    - secretKey: DB_HOST
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: DB_HOST
    - secretKey: DB_PORT
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: DB_PORT
    - secretKey: DB_USER
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: DB_USER
    - secretKey: DB_PASSWORD
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: DB_PASSWORD
    - secretKey: DB_NAME
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: DB_NAME
    - secretKey: AUTH_BEARER_TOKEN
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: AUTH_BEARER_TOKEN
    - secretKey: S3_ACCESS_KEY_ID
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: S3_ACCESS_KEY_ID
    - secretKey: S3_SECRET_ACCESS_KEY
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: S3_SECRET_ACCESS_KEY
    - secretKey: CLOUDWATCH_ACCESS_KEY_ID
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: CLOUDWATCH_ACCESS_KEY_ID
    - secretKey: CLOUDWATCH_SECRET_ACCESS_KEY
      remoteRef:
        key: /monitoring-dashboard/staging/app
        property: CLOUDWATCH_SECRET_ACCESS_KEY

ingress:
  hosts:
    - host: staging.xyibank.ru
      paths:
        - path: /api/v1/release-analyzer
          pathType: Prefix
          useGateway: true
        - path: /api/v1
          pathType: Prefix
          useGateway: true
        - path: /api
          pathType: Prefix
          useGateway: true
        - path: /ws
          pathType: Prefix
          useGateway: true
        - path: /
          pathType: Prefix
